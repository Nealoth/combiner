webpackJsonp([7],{516:function(module,exports){module.exports=function(template,cacheSvc,usersResource,$scope,needToRefresh){"use strict";var _this=this;this.templateName=template?template.Name:null,this.modules=[],this.isManage=!!template,this.buttonText=template?"Save changes":"Create template";var u=usersResource,_needToRefresh=needToRefresh;cacheSvc.get("systemModules").then(function(totalModules){_this.totalModules=totalModules}),this.refresh=function(method){cacheSvc[method]("systemModules").then(function(totalModules){var modules=JSON.parse(JSON.stringify(totalModules));modules.forEach(function(module){_this.associateModule(module)}),modules.forEach(function(module){module.ModuleIDParent&&modules.forEach(function(parentModule){parentModule.Id===module.ModuleIDParent&&(parentModule.children||(parentModule.children=[]),parentModule.children.push(module))})});var a=modules.filter(function(mainModule){return null===mainModule.ModuleIDParent});_this.modules=a})},_this.isManage&&this.refresh("update"),this.associateModule=function(module){var r=!1;template.modules.forEach(function(templateModule){module.Id==templateModule.ModuleID&&(r=!0)}),module.selected=r},this.select=function(node,isSelected){_needToRefresh||(needToRefresh=!0);var type=isSelected?"insert":"delete";u.urtm[type](template.Id,node.Id)},this.submit=function(){_this.isManage?u.urt.update(_this.templateName,template.Id):u.urt.create(_this.templateName),$scope.confirm(!0)},this.resetTree=function(){u.urtm.get(template.Id).then(function(updatedModules){template.modules=updatedModules,_this.refresh("update")})},setTimeout(function(){componentHandler.upgradeAllRegistered()},100)}}});